df <- read.csv("https://raw.githubusercontent.com/JG-Masters-Research/EEB622/refs/heads/main/funds_species_participants.csv?token=GHSAT0AAAAAADTVHEBH575PQ7GT7TJCOOKU2LPY5BQ")

set.seed(1)

df$SGCN_simulated <- 5 +
  0.04 * df$participants +
  rnorm(nrow(df), mean = 0, sd = 2)
plot(df$participants, df$SGCN_simulated,
     xlab = "Number of participants",
     ylab = "Number of SGCN")

abline(lm(SGCN_simulated ~ participants, data = df), col = "red")

model <- lm(SGCN_simulated ~ participants, data = df)

coef(model)

summary(model)$sigma

true_values <- c(intercept = 5, slope = 0.04, sigma = 2)

estimated_values <- c(
  intercept = coef(model)[1],
  slope     = coef(model)[2],
  sigma     = summary(model)$sigma
)

cbind(true_values, estimated_values)

calc_R2 <- function(model, data) {
  
  # Keep only complete cases used by the model
  model_data <- data[complete.cases(data[, c("SGCN_simulated", "participants")]), ]
  
  y_obs <- model_data$SGCN_simulated
  y_pred <- predict(model, newdata = model_data)
  
  ss_total <- sum((y_obs - mean(y_obs))^2)
  ss_resid <- sum((y_obs - y_pred)^2)
  
  R2 <- 1 - ss_resid / ss_total
  return(R2)
}

calc_R2(model, df)

summary(model)$r.squared
calc_R2(model, df)
